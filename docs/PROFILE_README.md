# ๐ค ุงูููู ุงูุดุฎุตู ููุณุชุฎุฏูู ุงููุฏุฑุณุฉ (School User Profile)

ููุฒุฉ ุฅุฏุงุฑุฉ ุงูููู ุงูุดุฎุตู ููุณุชุฎุฏูู ุงููุฏุฑุณุฉ (ADMIN / TEACHER / STUDENT / PARENT).

---

## ๐ ุงูู Endpoints

| Method | Endpoint | ุงููุตู | ุงูุญูุงูุฉ |
|--------|----------|-------|---------|
| `GET` | `/school/profile/me` | ุฌูุจ ุจูุงูุงุชู | โ JWT + School Context |
| `PATCH` | `/school/profile/me` | ุชุนุฏูู ุจูุงูุงุชู | โ JWT + School Context |
| `POST` | `/school/profile/change-password` | ุชุบููุฑ ูููุฉ ุงููุฑูุฑ | โ JWT + School Context |

**Headers ุงููุทููุจุฉ ูุฌููุน ุงูุทูุจุงุช:**
```
Authorization: Bearer <accessToken>
x-school-uuid: <school-uuid>
```

---

## 1๏ธโฃ ุฌูุจ ุงูููู ุงูุดุฎุตู

**`GET /school/profile/me`**

**Response:** `200 OK`
```json
{
  "uuid": "user-uuid",
  "userType": "TEACHER",
  "code": 1001,
  "name": "ุฃุญูุฏ ูุญูุฏ",
  "displayName": "ุฃุญูุฏ",
  "gender": "M",
  "phone": "777123456",
  "email": "ahmed@example.com",
  "province": "ุตูุนุงุก",
  "district": "ุดูููุฉ",
  "addressArea": "ุญู ุงูููุฑ",
  "addressDetails": "ุดุงุฑุน ุงูุฌุงูุนุฉุ ุจุฌูุงุฑ ูุณุฌุฏ ุงูููุฑ",
  "updatedAt": "2026-02-20T01:00:00.000Z"
}
```

> โ๏ธ ูุง ูุชู ุฅุฑุฌุงุน `passwordHash` ููุงุฆูุงู.

---

## 2๏ธโฃ ุชุนุฏูู ุงูููู ุงูุดุฎุตู

**`PATCH /school/profile/me`**

**ุงูุญููู ุงููุณููุญ ุจุชุนุฏูููุง (ุฌููุนูุง ุงุฎุชูุงุฑูุฉ):**

| ุงูุญูู | ุงูููุน | ุงููููุฏ | ุงููุตู |
|-------|-------|--------|-------|
| `displayName` | `string` | 2-50 ุญุฑู | ุงูุงุณู ุงููุนุฑูุถ |
| `gender` | `string` | ุญุชู 10 ุฃุญุฑู | ุงูุฌูุณ |
| `email` | `string` | ุจุฑูุฏ ุฅููุชุฑููู ุตุงูุญ | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| `province` | `string` | ุญุชู 100 ุญุฑู | ุงููุญุงูุธุฉ |
| `district` | `string` | ุญุชู 100 ุญุฑู | ุงููุฏูุฑูุฉ |
| `addressArea` | `string` | ุญุชู 100 ุญุฑู | ุงูููุทูุฉ |
| `addressDetails` | `string` | ุญุชู 255 ุญุฑู | ุชูุงุตูู ุงูุนููุงู |

> ๐ซ **ูุง ูููู ุชุนุฏูู:** `name` (ุงูุงุณู ุงูุฑุณูู), `userType`, `code`, `schoolId`, `isActive`

**Request Example:**
```json
{
  "displayName": "ุฃุจู ูุญูุฏ",
  "province": "ุนุฏู"
}
```

**Response:** `200 OK` โ ููุณ ุดูู `GET /me` (ุงูุจูุงูุงุช ุงููุญุฏูุซุฉ)

---

## 3๏ธโฃ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

**`POST /school/profile/change-password`**

> ๐ก **ุจุฏูู ุชุณุฌูู ุฎุฑูุฌ** โ ุงูุฌูุณุงุช ูุงูุชูููุงุช ุชุจูู ุตุงูุญุฉ ุจุนุฏ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ.

**Request Body:**

| ุงูุญูู | ุงูููุน | ูุทููุจ | ุงููููุฏ |
|-------|-------|-------|--------|
| `oldPassword` | `string` | โ | 6 ุฃุญุฑู ุนูู ุงูุฃูู |
| `newPassword` | `string` | โ | 6 ุฃุญุฑู ุนูู ุงูุฃูู |

**Request Example:**
```json
{
  "oldPassword": "myOldPass",
  "newPassword": "myNewPass123"
}
```

**Response:** `200 OK`
```json
{
  "success": true
}
```

---

## โ ุฃููุงุฏ ุงูุฃุฎุทุงุก

| ุงูููุฏ | ุงูุฑุณุงูุฉ | ุงููุตู |
|-------|---------|-------|
| `401` | `OLD_PASSWORD_WRONG` | ูููุฉ ุงููุฑูุฑ ุงููุฏููุฉ ุบูุฑ ุตุญูุญุฉ |
| `400` | `NEW_PASSWORD_SAME_AS_OLD` | ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ ูุทุงุจูุฉ ูููุฏููุฉ |
| `401` | `Unauthorized` | ุชููู ุบูุฑ ุตุงูุญ ุฃู ููููุฏ |
| `403` | `SCHOOL_SCOPE_MISMATCH` | `x-school-uuid` ูุง ูุทุงุจู ุงููุฏุฑุณุฉ ูู ุงูุชููู |
| `403` | `SCHOOL_INACTIVE` | ุงููุฏุฑุณุฉ ูููููุฉ |
| `403` | `USER_INACTIVE` | ุงููุณุชุฎุฏู ููููู |
| `404` | `USER_NOT_FOUND` | ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ |

---

## ๐ ูููููุฉ ุงููููุงุช

```
src/school/profile/
โโโ profile.module.ts          # ุชุณุฌูู ุงููุญุฏุฉ
โโโ profile.controller.ts      # endpoints: me, update, change-password
โโโ profile.service.ts         # ููุทู ุฌูุจ/ุชุนุฏูู/ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
โโโ dto/
    โโโ update-profile.dto.ts  # DTO: ุชุนุฏูู ุงูููู ุงูุดุฎุตู
    โโโ change-password.dto.ts # DTO: ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
```

---

## ๐ ุงูุญูุงูุฉ

- **`SchoolJwtAuthGuard`**: ูุชุญูู ูู ุตุญุฉ ุงูู JWT + ุงูุฌูุณุฉ ูู DB + ุญุงูุฉ ุงููุณุชุฎุฏู ูุงููุฏุฑุณุฉ
- **`SchoolContextGuard`**: ูุทุงุจู `x-school-uuid` (Header) ูุน `sc` (JWT payload)
